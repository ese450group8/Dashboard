
<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="shortcut icon" href="http://cdn.osxdaily.com/wp-content/uploads/2014/06/health-app-icon.png">
  <title>Dashboard</title>


  <! Bootstrap Core CSS >
  <link href="bootstrap.min.css" rel="stylesheet">

  <!-- MetisMenu CSS -->
  <link href="metisMenu.min.css" rel="stylesheet">

  <!-- DataTables CSS -->
  <link href="dataTables.bootstrap.css" rel="stylesheet">

  <!-- DataTables Responsive CSS -->
  <link href="dataTables.responsive.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link href="sb-admin-2.css" rel="stylesheet">

  <!-- Custom Fonts -->
  <link href="font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <![endif]-->
  <! table head>
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="http://papaparse.com/resources/js/papaparse.js"></script>
  <script src="main.js"></script>
  <link rel="stylesheet" href="main.css">

</head>

<body>

  <div id="wrapper">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
      <div class="navbar-header">
        <img src="https://upload.wikimedia.org/wikipedia/en/thumb/e/e1/Penn_Medicine_and_University_of_Pennsylvania_Health_System_logo.svg/1280px-Penn_Medicine_and_University_of_Pennsylvania_Health_System_logo.svg.png" alt="Image_Error" style="width:336px;height:49px;">
      </div>
      <!-- /.navbar-header -->

      <div class="navbar-default sidebar" role="navigation">
        <div class="sidebar-nav navbar-collapse">
          <ul class="nav" id="side-menu">
            <!edit for tabs>
            <li>
              <a href="populationLevel2.html"><i class="fa fa-table fa-fw"></i> Data Level</a>
            </li>
            <li>
              <a href="#"><i class="fa fa-folder-open-o fa-fw"></i> Patient Notes</a>
            </ul>
            <!-- /.nav-second-level -->
          </li>
          <li>
            <a href="#"><i class="fa fa-sitemap fa-fw"></i> Multi-Level Dropdown<span class="fa arrow"></span></a>
            <ul class="nav nav-second-level">
              <li>
                <a href="#">Second Level Item</a>
              </li>
              <li>
                <a href="#">Second Level Item</a>
              </li>
              <li>
                <a href="#">Third Level <span class="fa arrow"></span></a>
                <ul class="nav nav-third-level">
                  <li>
                    <a href="#">Third Level Item</a>
                  </li>
                  <li>
                    <a href="#">Third Level Item</a>
                  </li>
                  <li>
                    <a href="#">Third Level Item</a>
                  </li>
                  <li>
                    <a href="#">Third Level Item</a>
                  </li>
                </ul>
                <!-- /.nav-third-level -->
              </li>
            </ul>
            <!-- /.nav-second-level -->
          </li>
        </ul>
      </div>
      <!-- /.sidebar-collapse -->
    </div>
    <!-- /.navbar-static-side -->
  </nav>
  <p>testseterasdfads</p>
  <!Sidebar>
  <div id="page-wrapper">
    <div class="row">
      <div class="col-lg-12">
        <h1 class="page-header"> Data Level </h1>
      </div>
      <!-- /.col-lg-12 -->
    </div>
    <!-- /.row -->
    <div class="row">
      <div class="col-lg-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <!-- Write at top of Screen if you want -->
          </div>
          <!retrieving data from CSV file>
          <head>
            <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
            <script src="http://code.jquery.com/jquery-1.8.3.min.js" type="text/javascript" charset="utf-8"></script>
            <script src="jquery.tipsy.js" type="text/javascript" charset="utf-8"></script>
            <link rel="stylesheet" href="http://onehackoranother.com/projects/jquery/tipsy/stylesheets/tipsy.css" type="text/css" title="no title" charset="utf-8"/>
            <style type="text/css">
            .axis path,
            .axis line {
              fill: none;
              stroke: #000;
              shape-rendering: crispEdges;
              opacity: 1;
            }

            .axis text { font-size:10px; }

            body { font: 12px sans-serif; }
            .circles { opacity: .5; }

            .tipsy { font-size:11px; margin-top:-10px;}

            .guide line {
              fill: none;
              stroke: #000;
              shape-rendering: crispEdges;
              opacity: 0;
            }
            </style>
          </head>
          <body>
            <div id="chart">

              <script type="text/javascript">
                    // set the stage
                    var margin = {t:30, r:20, b:20, l:40 },
                    w = 600 - margin.l - margin.r,
                    h = 500 - margin.t - margin.b,
                    x = d3.scale.linear().range([0, w]),
                    y = d3.scale.linear().range([h - 60, 0]),
                      //colors that will reflect pre or post prandial
                      color = d3.scale.category10();

                      var svg = d3.select("#chart").append("svg")
                      .attr("width", w + margin.l + margin.r)
                      .attr("height", h + margin.t + margin.b);

                      // set axes, as well as details on their ticks
                      var xAxis = d3.svg.axis()
                      .scale(x)
                      .ticks(20)
                      .tickSubdivide(true)
                      .tickSize(6, 3, 0)
                      .orient("bottom");

                      var yAxis = d3.svg.axis()
                      .scale(y)
                      .ticks(20)
                      .tickSubdivide(true)
                      .tickSize(6, 3, 0)
                      .orient("left");

                      // group that will contain all of the plots
                      var groups = svg.append("g").attr("transform", "translate(" + margin.l + "," + margin.t + ")");

                      // array of the regions, used for the legend
                      var regions = ["Above Avg", "Below Avg"]

                      var legendColors = [true, false];

                    // bring in the data, and do everything that is data-driven
                    d3.csv("smallTest.csv", function(data) {

                      //var x0 = Math.max(-d3.min(data, function(d) { return d.trust; }), d3.max(data, function(d) { return d.trust; }));
                      x.domain([0, 30]);
                      y.domain([0, 500])

                      var temp = [];
                      var thisID = 517;
                      var thisMonth = 4;
                      var patSum = 0;
                      var patAvg;
                      // CHOOSE THE PATIENT AND MONTH YOU WANT TO GRAPH

                      for (var index in data) {
                        if (data[index].ID == thisID && parseInt(data[index].time.split("/")[0]) == thisMonth) {
                            // push objects we want
                            temp.push(data[index]);

                            // calculate sum of selected patient's glucose levels for that month to compute patient average
                            patSum = patSum + parseInt(data[index].glucose);
                          }
                        }

                        patAvg = patSum / (temp.length + 1);

                        for (var index in temp) {

                      // Flag is true when the patient's glucose reading is higher than normal
                      temp[index].flag = temp[index].glucose > patAvg;
                      console.log(patAvg)
                      console.log(temp[index].flag)
                      console.log(temp[index].glucose)
                  }

                      // style the circles, set their locations based on data
                      var circles =
                      groups.selectAll("circle")
                      .data(temp)
                      .enter().append("circle")
                      .attr("class", "circles")
                      .attr({
                        cx: function(d) { return x(+d.time.slice(d.time.indexOf("/")+1,d.time.length-5)); },
                        cy: function(d) { return y(+d.glucose); },
                        r: 8 // size of balls
                        //id: function(d) { return d.glucose; }
                    })
                      // possibility: give a different color for balls based on pre/postprandial
                      .style("fill", function(d) { return color(d.flag); });


                      // what to do when we mouse over a bubble
                      var mouseOn = function() { 
                        var circle = d3.select(this);

                      // transition to increase size/opacity of bubble
                      circle.transition()
                      .duration(800).style("opacity", 1)
                      .attr("r", 16).ease("elastic");

                      // append lines to bubbles that will be used to show the precise data points.
                      // translate their location based on margins
                      svg.append("g")
                      .attr("class", "guide")
                      .append("line")
                      .attr("x1", circle.attr("cx"))
                      .attr("x2", circle.attr("cx"))
                      .attr("y1", +circle.attr("cy") + 26)
                      .attr("y2", h - margin.t - margin.b)
                      .attr("transform", "translate(40,20)")
                      .style("stroke", circle.style("fill"))
                      .transition().delay(200).duration(400).styleTween("opacity", 
                        function() { return d3.interpolate(0, .5); })

                      svg.append("g")
                      .attr("class", "guide")
                      .append("line")
                      .attr("x1", +circle.attr("cx") - 16)
                      .attr("x2", 0)
                      .attr("y1", circle.attr("cy"))
                      .attr("y2", circle.attr("cy"))
                      .attr("transform", "translate(40,30)")
                      .style("stroke", circle.style("fill"))
                      .transition().delay(200).duration(400).styleTween("opacity", 
                        function() { return d3.interpolate(0, .5); });

                        // function to move mouseover item to front of SVG stage, in case
                      // another bubble overlaps it
                      d3.selection.prototype.moveToFront = function() { 
                        return this.each(function() { 
                          this.parentNode.appendChild(this); 
                        }); 
                      };

                      // skip this functionality for IE9, which doesn't like it
                      if (!$.browser.msie) {
                        circle.moveToFront(); 
                      }
                  };
                      // what happens when we leave a bubble?
                      var mouseOff = function() {
                        var circle = d3.select(this);

                      // go back to original size and opacity
                      circle.transition()
                      .duration(800).style("opacity", .5)
                      .attr("r", 8).ease("elastic");

                      // fade out guide lines, then remove them
                      d3.selectAll(".guide").transition().duration(100).styleTween("opacity", 
                        function() { return d3.interpolate(.5, 0); })
                      .remove()
                  };

                      // run the mouseon/out functions
                      circles.on("mouseover", mouseOn);
                      circles.on("mouseout", mouseOff);

                      // control what shows after hovering mouse over a ball
                      circles.append("title")
                      .text(function(d) { return d.glucose + " mg/dL"; })

                      $(".circles").tipsy({ gravity: 's', });

                      // the legend color guide
                      var legend = svg.selectAll("rect")
                      .data(legendColors)
                      .enter().append("rect")
                      .attr({
                        x: function(d, i) { return (40 + i*80); },
                        y: h,
                        width: 25,
                        height: 12
                      })
                      .style("fill", function(d) { return color(d); });


                      // legend labels  
                      svg.selectAll("text")
                      .data(regions)
                      .enter().append("text")
                      .attr({
                        x: function(d, i) { return (40 + i*80); },
                        y: h + 24,
                      })
                      .text(function(d) { return d; });

                      // draw axes and axis labels
                      svg.append("g")
                      .attr("class", "x axis")
                      .attr("transform", "translate(" + margin.l + "," + (h - 60 + margin.t) + ")")
                      .call(xAxis);

                      svg.append("g")
                      .attr("class", "y axis")
                      .attr("transform", "translate(" + margin.l + "," + margin.t + ")")
                      .call(yAxis);

                      svg.append("text")
                      .attr("class", "x label")
                      .attr("text-anchor", "end")
                      .attr("x", w + 50)
                      .attr("y", h - margin.t - 5)
                      .text("Day of Month");

                      svg.append("text")
                      .attr("class", "y label")
                      .attr("text-anchor", "end")
                      .attr("x", -20)
                      .attr("y", 45)
                      .attr("dy", ".75em")
                      .attr("transform", "rotate(-90)")
                      .text("Blood Glucose Level");
                  });
            </script>
          </body>
        </div>
      </div>
    </div>
    <! Population Data Location>
    <div class="dataTable_wrapper">
      <div class="col-lg-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <!-- Write at top of Screen if you want -->
          </div>
          <table class="table table-striped table-bordered table-hover">
            <thead>
              <tr>
                <!--add other column labels-->
              </tr>
            </thead>
          <table class="table table-bordered table-hover table-condensed" id = "results">
            <tbody>
              <script>
              $(function() {
                Papa.parse("smallTest.csv", {
                  download: true,
                  complete: function(results) {
                    console.log("Remote file parsed!", results.data);
                    $.each(results.data, function(i, el) {
                      var row = $("<tr/>");
                      row.append($("<td/>").text(i));
                      $.each(el, function(j, cell) {
                        if (cell !== "")
                          row.append($("<td/>").text(cell));
                      });
                      $("#results tbody").append(row);
                    });
                  }
                });
              });
             
              </script>
            </tbody>
          </table>
        </table>

</div>
</body>
</html>



